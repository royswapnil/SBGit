
@{
    ViewBag.Title = "Organizations";
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
}


<div class="banner1 bkSkyBlue">
    <i class="material-icons menuBtn1">menu</i>
    <span>Multi-Tenant User</span>
</div>


<style>
    .tanHP {
        background: #fff;
        border-radius: 0;
    }

    .searchT {
        border: 1px solid #eee;
    }

    .pinA select {
        border: 1px solid #ddd;
    }

    .pinA span {
        font-weight: bold;
        margin-top: 3px;
    }


    table.courselist {
        width: 100%;
        font-size: 13px;
        border: 1px solid #eaeaea !important;
    }

    .courselist thead {
        width: 100%;
        color: #19535f;
        font-weight: bold;
        font-size: 13px;
        border-top: 0px solid transparent;
        background: #ddd;
        font-weight: bold;
        font-size: 13px;
        border-bottom: 2px solid #28A7BE;
    }

    .courselist tbody {
        width: 100%;
    }

    .courselist tr {
        width: 100%;
    }

    .courselist tbody tr:last-child {
        border: none;
    }

    .courselist tr td {
        padding: 10px;
    }

        .courselist tr td:nth-child(1) {
            width: 25% !important;
        }

        .courselist tr td:nth-child(2) {
            width: 20% !important;
        }

        .courselist tr td:nth-child(3) {
            width: 20% !important;
        }



    .courselist tbody tr td:nth-child(1) {
        border-right: 2px solid #f0f3f5;
    }

    .courselist tr td a {
        color: #00d7ff;
    }



    .courselist tr td:nth-child(7) {
        width: 15% !important;
    }

    .courselist tbody tr {
        margin-top: 0px;
        border-bottom: 2px solid #f0f3f5;
    }

        .courselist tbody tr td a button {
            margin: 0;
        }

    .counter {
        padding: 10px;
        float: right;
        font-size: 15px;
        background: #ddd;
        width: 100%;
    }

        .counter i {
            background: #fff;
            color: #000;
        }

    .alert.alert-danger, .alert.alert-success, .alert.alert-info, .alert.alert-warning {
        width: 70%;
        margin-top: 20px;
    }

    .formArea {
        width: 100%;
        margin-top: 20px;
        padding-bottom: 60px;
        float: left;
    }

    .formBox1 .label {
        width: 100%;
        margin-bottom: 10px;
        font-weight: bold;
        font-size: 13px;
        float: left;
    }

    .formBox1 input, .formBox1 textarea, .formBox1 select {
        width: 100%;
        height: 30px;
        padding: 5px;
        font-size: 15px;
        border: 1px solid rgba(0, 0, 0, 0.39);
        border-radius: 3px;
        -webkit-border-radius: 3px;
        float: left;
    }

    .formBox1 textarea {
        height: 100px;
    }

    .formBox1 button {
        background: #760f91;
        border: none;
        border-radius: 3px;
        -webkit-border-radius: 3px;
        color: #fff;
        height: 30px;
        width: 120px;
        margin-top: -30px;
        float: right;
    }

    .bDGreen {
        border-bottom: 3px solid #2fbf71;
    }

    .Activated {
        background: #2fbf71;
    }

    .DeActivated {
        background: #ab192d;
    }
</style>
<div class="ViewPanel">
    <div class="content1">
        <div class="boxed1">

            <div class="boxHead1">
                <div class="boxHeader1 bBYellow">Quick Actions</div>
            </div>

            <div class="boxBody1">

                <div class="pad1 col41 bkPurple">
                    <sup>&nbsp;</sup>
                    <i class="material-icons">note_add</i>
                    <div class="vintage1">Add Organisation</div>
                </div>

                <div class="pad1 col41 bkPurpleBlue">
                    <sup>@ViewBag.TotalLearners</sup>
                    <i class="material-icons">group</i>
                    <div class="vintage1">Total Learners</div>
                </div>

                <div class="pad1 col41 bkDarkPink">
                    <sup>@ViewBag.ActiveOrg</sup>
                    <i class="material-icons">account_balance</i>
                    <div class="vintage1">Active Organisations</div>
                </div>

                <div class="pad1 col41 bkPink">
                    <sup>@ViewBag.ActiveCourses</sup>
                    <i class="material-icons">book</i>
                    <div class="vintage1">Active Courses</div>
                </div>


                <div class="boxHead1">
                    <div class="boxHeader1 bDOrange">All Organisations</div>
                </div>


                <div class="boxBody1">
                    <table class="org1 courselist" id="OrganizationTable">
                        <thead>
                            <tr>
                                <td>Names</td>
                                <td>Date Created</td>
                                <td>Action</td>
                                <td></td>
                            </tr>
                        </thead>
                        <tr class="empty">
                            <td colspan="4">
                                Fetching Data <br><br><i class="fa fa-spinner fa-pulse fa-2x fa-fw nofloat"></i>
                            </td>
                        </tr>

                    </table>
                </div>
            </div>
        </div>
    </div>
</div>


<div class="EditView" style="display:none">
    <div class="content1">
        <div class="boxed1">

            <div class="boxHead1">
                <div class="boxHeader1 bDGreen">View Organisation</div>
            </div>

            <input type="hidden" id="fName" />
            <div class="boxBody1">

                <div class="formArea" style="display:block">
                    <div class="formBox1 fullForm" style="float:right">
                        <img id="OrgLogo" height="150" width="150" />
                    </div>


                    <div class="formBox1 halfForm">
                        <label for="">ORGANISATION </label>
                        <textarea name="" id="OrgName" cols="30" rows="10"></textarea>
                    </div>

                    <div class="formBox1 halfForm">
                        <div class="prop">Status:</div>
                        <div class="val" id="OrgActive"></div>

                        <div class="prop">Date created:</div>
                        <div class="val" id="OrgDate"></div>
                    </div>


                    <div class="formBox1 halfForm">
                        <div class="prop">Email:</div>
                        <div class="val" id="OrgEmail"></div>

                        <div class="prop">Subscription type:</div>
                        <div class="val" id="OrgSubType"></div>
                    </div>


                    <div class="formBox1 halfForm">
                        <div class="prop">Website:</div>
                        <div class="val" id="OrgWebSite"></div>

                        <div class="prop">LMS Access URL:</div>
                        <div class="val" id="OrgDomain"></div>
                    </div>


                    <div class="formBox1 fullForm">
                        <button class="btn1 bkSkyBlue">Generate Report</button>
                    </div>

                </div>

            </div>



            <div class="boxHead1" style="margin-top:-20px">
                <div class="boxHeader1 bDCyanBlue">All Courses</div>
            </div>


            <div class="boxBody1">
                <div class="tableRanch">
                    <table class="orga" id="CourseTable">
                        <thead>
                            <tr>
                                <td>Course title</td>
                                <td>Learning Area</td>
                                <td>Date created</td>
                                <td>Status</td>
                                <td>Action</td>
                            </tr>
                        </thead>

                    </table>
                </div>

            </div>
        </div>
    </div>
</div>


<style>
    .formArea textarea {
        background: #efefef;
        border: none;
        padding: 10px;
        height: 70px;
    }

    .prop {
        float: left;
        width: 50%;
        font-size: 15px;
        font-weight: bold;
        margin-bottom: 10px;
    }

    .val {
        float: left;
        width: 50%;
        font-size: 15px;
        margin-bottom: 10px;
    }

    a.toggle {
        float: left;
        padding: 10px;
        font-size: 13px;
        color: #444;
        background: #ddd;
        margin-right: 20px;
        border-radius: 15px;
        webkit-border-radius: 15px;
        font-weight: bold;
        margin-bottom: 40px;
    }

        a.toggle:hover, a.toggle.active {
            background: #0cdae8;
            color: #fff;
        }

    table.orga {
        width: 100%;
        font-size: 13px;
        float: left;
    }

    .orga thead {
        width: 100%;
        color: #0094dc;
        font-weight: bold;
        font-size: 13px;
        padding-bottom: 3px;
        padding-top: 3px;
        margin-bottom: 5px;
        background: #fbfbfb;
        border-top: 0px solid transparent;
        float: left;
    }

    .orga tbody {
        width: 100%;
        float: left;
    }

    .orga tr {
        width: 100%;
        float: left;
    }

        .orga tr td {
            padding: 10px;
            float: left;
        }

            .orga tr td:nth-child(3), .orga tr td:nth-child(2), .orga tr td:nth-child(4), .orga tr td:nth-child(5) {
                width: 17.5%;
            }

            .orga tr td a {
                color: #00d7ff;
            }

            .orga tr td:nth-child(1) {
                width: 30%;
            }

    .orga tbody tr:nth-child(even) {
        background: #fbfbfb;
    }

    .orga tbody tr:nth-child(odd) {
        background: #fff;
    }

    .orga tbody tr {
        margin-top: 0px;
    }

        .orga tbody tr td a button {
            margin-top: -5px;
            float: left;
        }

    .orga span.ina {
        color: #bbb;
        float: left;
    }
</style>

@section Scripts{
    <script src="~/Scripts/jquery.validate.min.js"></script>
    <script src="~/Content/js/additional-methods.min.js"></script>
    <script src="~/Content/js/CustomValidation.js"></script>
    <script src="~/Content/js/datatables.min.js"></script>
    <script>
        $(document).ready(function () {
            //Load the Budget table


            var jqTable = $('#OrganizationTable').DataTable({
                dom: '<"tanHead tanHP"f>rt<"counter"lip>',
                "autoWidth": false,
                processing: true,
                serverSide: true,
                ajax: {
                    "url": '/api/organization/allorganization',
                    "type": "GET"
                },
                'language': {
                    'search': '',
                    'searchPlaceholder': 'Search...'
                },
                "fnDrawCallback": function (oSettings) {
                },
                "order": [],
                columns: [
                    {
                        bSortable: true,
                        "render": function (d, i, data) {

                            return data.OrganizationName;
                        }
                    },
                    {
                        bSortable: true,
                        "render": function (d, i, data) {

                            return data.CreatedDateFormat;
                        }
                    },
                    {
                        "render": function (d, r, data) {
                            return '<a href=""class="editOrg" data-name="' + data.OrganizationName + '" data-id="' + data.OrganizationId + '"><i class="fa fa-eye"></i><span>View&emsp;</span></a>' +
                                '<a href="" class="genReport" data-id="' + data.OrganizationId + '"><i class="material-icons">assignment</i><span>Generate Report</span></a>'
                        }
                    },

                    {
                        bSortable: false,
                        className: "action-buttons",
                        "render": function (d, i, data) {

                            return '<button class="table-activate btnSmaller bkPurple ' + data.OrganizationalStatusFormat + '" href="javascript:;">' + data.OrganizationalStatusFormat + '</button>' +

                                '<input type="hidden" value="' + data.OrganizationId + '"/>';
                        }
                    }
                ]
            });

            jqTable.on('draw', function () {

                $('.tableRanch').find('input[type="search"]').addClass('searchT');
                // reset();
            });

            $("#OrganizationTable tbody").on("click", ".editOrg", function (e) {

                e.preventDefault();
                var $button = $(this);
                var prev = $button.html();

                var $id = $(this).attr('data-id');
                var $name = $(this).attr('data-name');
                $('#fName').val($name);
                window.location.href = '#viewdetails?org_name=' + $name;
                if (!parseInt($id) && parseInt($id) <= 0) {
                    return;
                }
                $button.attr('disabled', 'disabled');
                $button.find('i').removeClass('fa-eye');
                $button.find('i').addClass('fa-circle-o-notch fa-spin');
                
                $.ajax({
                    url: '/api/organization/getorganizationdetails',
                    type: 'GET',
                    data: { id: $id },
                    success: function (data) {
                        if (!data.HasError) {
                            $('#OrgLogo').attr('src', data.Result.LogoUrl);
                            $('#OrgName').html(data.Result.OrganizationName);
                            $('#OrgDate').html(data.Result.CreatedDateFormat);
                            $('#OrgActive').html(data.Result.OrganizationalStatusFormat);
                            $('#OrgEmail').html(data.Result.Email);
                            $('#OrgDomain').html(data.Result.SubDomain);
                            $('#OrgSubType').html('N/A');
                            $('#OrgWebSite').html(data.Result.SubDomain);
                            $('.ViewPanel').fadeOut();
                            $('.EditView').fadeIn();

                        }
                        else {
                            ShowNotie(data)
                        }
                    },
                    error: function (data) {
                        ShowNotie({ Message: "An Error has occured. Cannot retrieve Organization details" });
                    }
                })
                var data = { id: $id }
                var jqTable = $('#CourseTable').DataTable({
                    dom: '<"tanHead tanHP"f>rt<"counter"lip>',
                    "autoWidth": false,
                    processing: true,
                    serverSide: true,
                    ajax: {
                        "url": '/api/organization/getorganization',
                        "type": "GET",
                        "data": function (d) {
                            d.AdditionalParameters = JSON.stringify(data);
                        },
                    },
                    'language': {
                        'search': '',
                        'searchPlaceholder': 'Search ...'
                    },
                    "fnDrawCallback": function (oSettings) {
                        window.location.href = "#viewdetails?organization_name=" + $('#fName').val();
                    },
                    "order": [],
                    columns: [
                        {
                            bSortable: true,
                            "render": function (d, i, data) {

                                return data.Name;
                            }
                        },
                        {
                            bSortable: true,
                            "render": function (d, i, data) {

                                return data.LearningAreaName;
                            }
                        },
                        {
                            "render": function (d, r, data) {
                                return data.CreatedDateFormat;
                            }
                        },
                        {
                            "render": function (d, i, data) {
                                return data.IsPublishedFormat;
                            }
                        },

                        {
                            bSortable: true,
                            "render": function (d, r, data) {
                                return '<a href=""class="viewcourse" data-id="' + data.Id + '"><i class="fa fa-eye"></i><span>View&emsp;</span></a>';
                            }
                        }
                    ]
                });

                jqTable.on('draw', function () {

                    $('.tableRanch').find('input[type="search"]').addClass('searchT');
                    // reset();
                });
            });
        });
    </script>
}
